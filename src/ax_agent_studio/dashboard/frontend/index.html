<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Factory | aX Monitor Studio</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üè≠</text></svg>">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üè≠ Agent Factory</h1>
            <div class="header-actions">
                <div id="kill-switch-status" style="display: none; margin-right: 1rem; padding: 0.5rem 1rem; background: #fef3c7; color: #92400e; border-radius: 4px; font-weight: 600;">
                    üõë Kill Switch Active
                </div>
                <button id="pause-all-btn" class="btn btn-danger" title="Pause all running agents">üõë Pause All</button>
                <button id="reset-all-btn" class="btn btn-warning" title="Reset backlog for all agents in this environment">üîÑ Reset</button>
                <button id="kill-btn" class="btn btn-danger" title="Nuclear option: Force kill ALL monitor processes (kills money burning!)">‚ò†Ô∏è Kill</button>
            </div>
        </header>

        <div class="main-content">
            <!-- Left Panel: Monitor Control -->
            <div class="left-panel">
                <section class="card">
                    <h2 style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleRunningAgents()">
                        <span>ü§ñ Running Agents</span>
                        <span id="agents-toggle" style="font-size: 1.2rem;">‚ñº</span>
                    </h2>
                    <div id="monitors-list" class="monitors-list">
                        <p class="empty-state">No agents running</p>
                    </div>
                </section>

                <section class="card">
                    <h2 style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleDeployForm()">
                        <span>‚ö° Deploy New Agent</span>
                        <span id="deploy-toggle" style="font-size: 1.2rem;">‚ñº</span>
                    </h2>
                    <form id="start-monitor-form">
                        <div class="form-group">
                            <label for="environment-select">Environment:</label>
                            <select id="environment-select" required>
                                <option value="">Loading...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="agent-select">Agent:</label>
                            <select id="agent-select" required>
                                <option value="">Select environment first...</option>
                            </select>
                            <small class="form-help" id="agent-help"></small>
                        </div>

                        <div class="form-group">
                            <label for="monitor-type-select">Agent Type:</label>
                            <select id="monitor-type-select" required>
                                <option value="echo">üîä Echo (Simple)</option>
                                <option value="ollama">ü§ñ Ollama (AI)</option>
                                <option value="claude_agent_sdk">üõ° Claude Agent SDK (Secure)</option>
                                <option value="openai_agents_sdk">ü§ñ OpenAI Agents SDK</option>
                                <option value="langgraph">üß† LangGraph (Tools)</option>
                            </select>
                        </div>

                        <div class="form-group" id="provider-group" style="display: none;">
                            <label for="provider-select">Provider:</label>
                            <select id="provider-select" required>
                                <option value="">Loading...</option>
                            </select>
                            <small class="form-help" id="provider-help"></small>
                        </div>

                        <div class="form-group" id="model-group" style="display: none;">
                            <label for="model-select">Model:</label>
                            <select id="model-select">
                                <option value="">Loading...</option>
                            </select>
                        </div>

                        <div class="form-group" id="system-prompt-group" style="display: none;">
                            <label for="system-prompt-select">System Prompt (optional):</label>
                            <select id="system-prompt-select">
                                <option value="">None (use model defaults)</option>
                            </select>
                            <small class="form-help" id="prompt-help">Choose a personality template</small>
                        </div>

                        <!-- Memory Depth feature disabled - needs server-side support
                        <div class="form-group" id="history-limit-group" style="display: none;">
                            <label for="history-limit-select">Memory Depth:</label>
                            <select id="history-limit-select">
                                <option value="10">Basic (10 messages)</option>
                                <option value="25" selected>Standard (25 messages)</option>
                                <option value="50">Boost (50 messages)</option>
                                <option value="100">Maximum (100 messages)</option>
                            </select>
                            <small class="form-help">Conversation history to remember</small>
                        </div>
                        -->

                        <button type="submit" class="btn btn-primary">‚ñ∂Ô∏è Deploy Agent</button>

                        <div class="form-group" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #374151;">
                            <label for="test-sender-select">Test Sender Agent:</label>
                            <select id="test-sender-select">
                                <option value="">Auto (first available)</option>
                            </select>
                            <small class="form-help">Agent that sends test messages when you click ‚úèÔ∏è</small>
                        </div>
                    </form>
                </section>

                <section class="card">
                    <h2>üì¶ Deployment Groups</h2>
                    <div id="deployment-groups-list" class="deployment-groups-list">
                        <p class="empty-state">Loading deployment groups...</p>
                    </div>
                </section>
            </div>

            <!-- Right Panel: Logs -->
            <div class="right-panel">
                <section class="card logs-card">
                    <h2 style="display: flex; justify-content: space-between; align-items: center; cursor: pointer;" onclick="toggleLiveLogs()">
                        <span>üìú Live Logs</span>
                        <span id="logs-toggle" style="font-size: 1.2rem;">‚ñº</span>
                    </h2>
                    <div id="logs-section">
                    <div class="logs-controls">
                        <select id="log-filter">
                            <option value="all">All Agents</option>
                        </select>
                        <button id="refresh-logs-btn" class="btn btn-secondary btn-sm">üîÑ Refresh</button>
                        <button id="copy-logs-btn" class="btn btn-secondary btn-sm">üìã Copy</button>
                        <button id="clear-logs-btn" class="btn btn-secondary btn-sm">üóëÔ∏è Clear</button>
                        <div class="checkbox-stack">
                            <label class="checkbox-label">
                                <input type="checkbox" id="auto-scroll" checked>
                                Auto-scroll
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="verbose-mode" checked>
                                Verbose
                            </label>
                        </div>
                    </div>
                    <div id="logs-container" class="logs-container">
                        <p class="empty-state">Waiting for logs...</p>
                    </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeAuthModal()">&times;</span>
            <h3>üîê Authentication Required</h3>
            <p id="auth-message"></p>
            <div id="auth-progress" style="display: none;">
                <p>üåê Opening browser for OAuth authentication...</p>
                <p>Please complete the authentication in your browser.</p>
            </div>
            <div class="modal-actions">
                <button id="btn-authenticate" class="btn btn-primary" onclick="authenticateAgent()">
                    Authenticate Now
                </button>
                <button class="btn btn-secondary" onclick="closeAuthModal()">
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
